{"title":"微服务:API Gateway","uid":"4d9104954e68f25499a2e47d5b935f32","slug":"微服务-API-Gateway","date":"2022-08-17T02:52:25.000Z","updated":"2022-08-29T08:55:33.248Z","comments":true,"path":"api/articles/微服务-API-Gateway.json","keywords":null,"cover":[],"content":"<h2 id=\"什么是-API网关\"><a href=\"#什么是-API网关\" class=\"headerlink\" title=\"什么是 API网关\"></a>什么是 API网关</h2><p>API网关是一个服务器,是系统的唯一入口.  从面向对象设计的角度看，它与外观模式类似.</p>\n<p>API网关封装了系统内部架构,为每个客户端提供一个定制的API.它可能还具有其它职责,如身份验证、监控、负载均衡、缓存、协议转换、限流熔断、静态响应处理.</p>\n<p>API网关方式的核心要点是: 所有的客户端和消费端都通过统一的网关接入微服务,在网关层处理所有的非业务功能. 通常，网关也是提供<code>REST/HTTP</code>的访问API.</p>\n<h2 id=\"网关应该具有那些能力\"><a href=\"#网关应该具有那些能力\" class=\"headerlink\" title=\"网关应该具有那些能力\"></a>网关应该具有那些能力</h2><p>微服务网关作为微服务后端服务的统一入口, 它可以统筹管理后端服务,主要分为<code>数据平面</code>和<code>控制平面</code>:</p>\n<p><code>数据平面</code>主要功能是接入用户的HTTP请求和微服务被拆分后的聚合.使用微服务网关统一对外暴露后端服务的API和契约,路由和过滤功能正是网关的核心能力模块.另外,<strong>微服务网关可以实现拦截机制和专注跨横切面的功能</strong>,包括协议转换、安全认证、熔断限流、灰度发布、日志管理、流量监控等.</p>\n<p><code>控制平面</code>主要功能是对后端服务做统一的管控和配置管理.例如,可以控制网关的弹性伸缩; 可以统一下发配置; 可以对网关服务添加标签; 可以在微服务网关上通过配置Swagger功能统一将后端服务的API契约暴露给使用方, 完成文档服务, 提高工作效率和降低沟通成本.</p>\n<ul>\n<li>限流</li>\n<li>熔断</li>\n<li>安全</li>\n<li>缓存</li>\n<li>重试</li>\n<li>负载均衡</li>\n<li>反向路由</li>\n<li>认证,鉴权</li>\n<li>日志收集</li>\n<li>监控</li>\n<li>IP列表:黑名单,白名单</li>\n<li>流量染色</li>\n<li>协议转换</li>\n<li>API管理</li>\n</ul>\n<p>下图 是 Kong 官方  的一个简单架构图.</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/majunmin/image/etcd/20220818200500.png\"></p>\n<h2 id=\"常见的开源网关对比\"><a href=\"#常见的开源网关对比\" class=\"headerlink\" title=\"常见的开源网关对比\"></a>常见的开源网关对比</h2><table>\n<thead>\n<tr>\n<th>功能</th>\n<th>Apache APISIX</th>\n<th>Kong</th>\n<th>Tyk</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>项目归属</td>\n<td>Apache</td>\n<td>Kong Inc</td>\n<td></td>\n</tr>\n<tr>\n<td>技术架构</td>\n<td>Nginx + etcd</td>\n<td>Nginx + postgres</td>\n<td>Golang + Redis</td>\n</tr>\n<tr>\n<td>部署模式</td>\n<td>单机&amp;集群</td>\n<td>单机&amp;集群</td>\n<td>单机&amp;集群</td>\n</tr>\n<tr>\n<td>单核Qps(开启限流和 prometheus)</td>\n<td>18,000</td>\n<td>1700</td>\n<td></td>\n</tr>\n<tr>\n<td>平均延时</td>\n<td>0.2ms</td>\n<td>2ms</td>\n<td></td>\n</tr>\n<tr>\n<td>配置生效时间</td>\n<td>时间通知, 低于 1ms</td>\n<td>定时轮询 5s</td>\n<td></td>\n</tr>\n<tr>\n<td>支持配置回滚</td>\n<td>[x]</td>\n<td>[]</td>\n<td></td>\n</tr>\n<tr>\n<td>热插件更新</td>\n<td>[x]</td>\n<td>[]</td>\n<td></td>\n</tr>\n<tr>\n<td>用户自定义负载均衡算法，路由</td>\n<td>[x]</td>\n<td>[]</td>\n<td>[]</td>\n</tr>\n<tr>\n<td>控制台</td>\n<td>[x]</td>\n<td>[]</td>\n<td>[]</td>\n</tr>\n</tbody></table>\n","text":"什么是 API网关API网关是一个服务器,是系统的唯一入口. 从面向对象设计的角度看，它与外观模式类似. API网关封装了系统内部架构,为每个客户端提供一个定制的API.它可能还具有其它职责,如身份验证、监控、负载均衡、缓存、协议转换、限流熔断、静态响应处理. API网关方式的核...","link":"","photos":[],"count_time":{"symbolsCount":952,"symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"微服务","slug":"微服务","count":2,"path":"api/tags/微服务.json"},{"name":"gateway","slug":"gateway","count":1,"path":"api/tags/gateway.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AF-API%E7%BD%91%E5%85%B3\"><span class=\"toc-text\">什么是 API网关</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%BD%91%E5%85%B3%E5%BA%94%E8%AF%A5%E5%85%B7%E6%9C%89%E9%82%A3%E4%BA%9B%E8%83%BD%E5%8A%9B\"><span class=\"toc-text\">网关应该具有那些能力</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%BC%80%E6%BA%90%E7%BD%91%E5%85%B3%E5%AF%B9%E6%AF%94\"><span class=\"toc-text\">常见的开源网关对比</span></a></li></ol>","author":{"name":"majm","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"技术分享","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"微服务 Trace","uid":"9a85a1a2b7a6a9bc3209cb287c73c69a","slug":"微服务-Trace","date":"2022-08-18T04:46:07.000Z","updated":"2022-08-29T08:51:32.897Z","comments":true,"path":"api/articles/微服务-Trace.json","keywords":null,"cover":null,"text":"Spection Trace 语义Trace代表一个调用链. 通常， 一个 Trace 可以被理解为一系列span 组成的有向无环图(DAG), span 之间的边称为 Reference. SpanSpan 表示一个跨进程的 RPC 或者进程内部的一个过程. 每个span 可以...","link":"","photos":[],"count_time":{"symbolsCount":"1k","symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"微服务","slug":"微服务","count":2,"path":"api/tags/微服务.json"},{"name":"trace","slug":"trace","count":1,"path":"api/tags/trace.json"}],"author":{"name":"majm","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"技术分享","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"awesome-blog","uid":"237d42f01cd872e0a7556a026d085cc6","slug":"awesome-blog","date":"2022-08-16T12:45:48.000Z","updated":"2022-09-08T05:02:48.272Z","comments":true,"path":"api/articles/awesome-blog.json","keywords":null,"cover":null,"text":"golang极客兔兔跟煎鱼学GoO神的博客曹大的博客 Java小马哥的技术博客田小波的技术博客 Architechcleancoders解道凤凰架构 LinuxFRIMIN鸟哥的首页Vamei 算法谭新宇LABULADONG 的算法网站结构之法算法之道kuangbin - 博客园...","link":"","photos":[],"count_time":{"symbolsCount":348,"symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"blog","slug":"blog","count":3,"path":"api/tags/blog.json"}],"author":{"name":"majm","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"技术分享","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}