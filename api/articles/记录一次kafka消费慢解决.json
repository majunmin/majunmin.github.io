{"title":"è®°å½•ä¸€æ¬¡kafkaæ¶ˆè´¹æ…¢è§£å†³","uid":"b6fcd1b6df52f1cbb0ed1f5a0d130f42","slug":"è®°å½•ä¸€æ¬¡kafkaæ¶ˆè´¹æ…¢è§£å†³","date":"2019-08-03T10:37:02.000Z","updated":"2019-08-03T10:49:19.000Z","comments":true,"path":"api/articles/è®°å½•ä¸€æ¬¡kafkaæ¶ˆè´¹æ…¢è§£å†³.json","keywords":null,"cover":null,"content":"<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>æœ€è¿‘ä½¿ç”¨kafka, æ¶ˆè´¹è€…é€Ÿåº¦ä¸€ç›´è·Ÿä¸ä¸Šï¼Œé€ æˆçº¿ä¸Šæ¶ˆæ¯å †ç§¯åˆ°äº† 101äº¿ï¼Œå›°æ‰°äº†å¥½å‡ å¤©ï¼Œç»ˆäºè§£å†³äº†ã€‚ï¼ˆå…¶å®å¾ˆç®€å•ï¼Œå› ä¸º kafkaæ¶ˆè´¹é€Ÿåº¦æœ¬æ¥ä¹Ÿä¸æ…¢ ğŸ˜‚ğŸ˜‚ğŸ˜‚ğŸ˜‚,å…¶å®å¼‚æ­¥+ æ‰¹é‡æ¶ˆè´¹å°±æ»¡å¯ä»¥è¾¾åˆ°è¦æ±‚äº†ï¼‰</p></blockquote>\n<span id=\"more\"></span>\n\n<p>ä¸»è¦åŸå› æœ‰ä¸¤ä¸ªï¼Œ</p>\n<ol>\n<li>å¯¹ @Async æ³¨è§£çš„ä¸ç†è§£</li>\n<li>æ‰¹é‡æ¶ˆè´¹</li>\n<li>â€“ è¿˜æœ‰å°±æ˜¯é€šè¿‡è¿™æ¬¡äº‹ä»¶ï¼Œä¹Ÿäº†è§£äº†ç‚¹ è‡ªåŠ¨æäº¤ä¸ æ‰‹åŠ¨æäº¤çš„æ¦‚å¿µ</li>\n</ol>\n<p>ä¸€èˆ¬ kafka æ¶ˆè´¹æ…¢çš„ è§£å†³æ€è·¯æœ‰ä¸€ä¸‹å‡ ç§ï¼š</p>\n<ol>\n<li>å¢åŠ åˆ†åŒºæ•°</li>\n<li>æ‰¹é‡æ¶ˆè´¹(å¢åŠ æ‹‰å–æ‰¹æ¬¡ï¼Œ é»˜è®¤ 500)</li>\n<li>æ¯æ¬¡æ‹‰å–åï¼Œæœ¬åœ°å¯çº¿ç¨‹æ± å¼‚æ­¥æ¶ˆè´¹ (æ³¨æ„ kafkaConsumer æ˜¯ éçº¿ç¨‹å®‰å…¨çš„)</li>\n<li>å¦‚æœæ¶ˆè´¹å¤šä¸ªtopicçš„è¯ï¼Œä¿®æ”¹åˆ†åŒºç­–ç•¥ä¸º StickyAssignor.class(é»˜è®¤ RangeAssignor.class)</li>\n</ol>\n<p>è¿™é‡Œä½¿ç”¨ï¼Œ spring-kafka æ³¨è§£å½¢å¼</p>\n<p>kafka é…ç½®</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">KafkaListenerContainerFactory</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConcurrentMessageListenerContainer</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">listenerContainerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token class-name\">ConcurrentKafkaListenerContainerFactory</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> factory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcurrentKafkaListenerContainerFactory</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    factory<span class=\"token punctuation\">.</span><span class=\"token function\">setConsumerFactory</span><span class=\"token punctuation\">(</span><span class=\"token function\">consumerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// é£˜é›¶æ¶ˆè´¹ éœ€è¦è®¾ç½® ä¸º true</span>\n    factory<span class=\"token punctuation\">.</span><span class=\"token function\">setBatchListener</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// å•æœºæ¶ˆè´¹è€…æ•°é‡</span>\n    factory<span class=\"token punctuation\">.</span><span class=\"token function\">setConcurrency</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// æ‹‰å–è¶…æ—¶æ—¶é—´</span>\n    factory<span class=\"token punctuation\">.</span><span class=\"token function\">getContainerProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setPollTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> factory<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">ConsumerFactory</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">consumerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultKafkaConsumerFactory</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token function\">consumerConfigs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">consumerConfigs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> propsMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    propsMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConsumerConfig</span><span class=\"token punctuation\">.</span>BOOTSTRAP_SERVERS_CONFIG<span class=\"token punctuation\">,</span> <span class=\"token string\">\"localhost:2181\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    propsMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConsumerConfig</span><span class=\"token punctuation\">.</span>ENABLE_AUTO_COMMIT_CONFIG<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    propsMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConsumerConfig</span><span class=\"token punctuation\">.</span>AUTO_COMMIT_INTERVAL_MS_CONFIG<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// æœ€å¤§æ‹‰å–æ¶ˆæ¯æ¡æ•°ï¼Œ é»˜è®¤ 500 ,å¯ä»¥è°ƒå¤§æ­¤å‚æ•°ï¼Œ æ­¤å‚æ•°è¿‡å¤§ï¼Œ ä¹Ÿå¯èƒ½ä¼šå‡ºç° OOM</span>\n    propsMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConsumerConfig</span><span class=\"token punctuation\">.</span>MAX_POLL_RECORDS_CONFIG<span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    propsMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConsumerConfig</span><span class=\"token punctuation\">.</span>SESSION_TIMEOUT_MS_CONFIG<span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    propsMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConsumerConfig</span><span class=\"token punctuation\">.</span>KEY_DESERIALIZER_CLASS_CONFIG<span class=\"token punctuation\">,</span> <span class=\"token class-name\">StringDeserializer</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    propsMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConsumerConfig</span><span class=\"token punctuation\">.</span>VALUE_DESERIALIZER_CLASS_CONFIG<span class=\"token punctuation\">,</span> <span class=\"token class-name\">StringDeserializer</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    propsMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConsumerConfig</span><span class=\"token punctuation\">.</span>AUTO_OFFSET_RESET_CONFIG<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> propsMap<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>æ¶ˆè´¹</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Consumer</span> <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token annotation punctuation\">@Resource</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">KafkaConsumeService</span> kafkaConsumerService<span class=\"token punctuation\">;</span>\n\n\n    <span class=\"token annotation punctuation\">@KafkaListener</span><span class=\"token punctuation\">(</span>topics <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"$&#123;topic&#125;\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"$&#123;topic2&#125;\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> groupId <span class=\"token operator\">=</span> <span class=\"token string\">\"$&#123;group.id&#125;\"</span><span class=\"token punctuation\">,</span> containerFactory <span class=\"token operator\">=</span> <span class=\"token string\">\"listenerContainerFactory\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">consume</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConsumerRecord</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> records<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        kafkaConsumerService<span class=\"token punctuation\">.</span><span class=\"token function\">consume</span><span class=\"token punctuation\">(</span>records<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ConsumeServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">KafkaConsumeService</span> <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token annotation punctuation\">@Resource</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ADMapper</span> <span class=\"token class-name\">AdMapper</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * æ‰¹é‡æ¶ˆè´¹\n     * @param records\n     */</span>\n    <span class=\"token annotation punctuation\">@Async</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"executor\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">consume</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConsumerRecord</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> records<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        records<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">::</span><span class=\"token function\">consume</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * å•æ¡æ¶ˆè´¹\n     * @param record\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">consume</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConsumerRecord</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">record</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token class-name\">String</span> key <span class=\"token operator\">=</span> <span class=\"token keyword\">record</span><span class=\"token punctuation\">.</span><span class=\"token function\">key</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> value <span class=\"token operator\">=</span> <span class=\"token keyword\">record</span><span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ConsumeServiceImpl.consume, key=&#123;&#125;, value=&#123;&#125;\"</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token function\">saveInDb</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ConsumeServiceImpl.consume error, \"</span><span class=\"token punctuation\">,</span> ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>@Async  çš„ä½¿ç”¨</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@EnableAsync</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ExecutorConfig</span> <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token comment\">/**\n     * Set the ThreadPoolExecutor's core pool size.\n     */</span>\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;executor.corepoolsize:8&#125;\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> corePoolSize<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">/**\n     * Set the ThreadPoolExecutor's maximum pool size.\n     */</span>\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;executor.maxpoolsize:10&#125;\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> maxPoolSize<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">/**\n     * Set the capacity for the ThreadPoolExecutor's BlockingQueue.\n     */</span>\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;executor.queueCapacity:500&#125;\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> queueCapacity<span class=\"token punctuation\">;</span>\n\n\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"executor\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Executor</span> <span class=\"token function\">insertExecutor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token class-name\">ThreadPoolTaskExecutor</span> executor <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadPoolTaskExecutor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        executor<span class=\"token punctuation\">.</span><span class=\"token function\">setCorePoolSize</span><span class=\"token punctuation\">(</span>corePoolSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        executor<span class=\"token punctuation\">.</span><span class=\"token function\">setMaxPoolSize</span><span class=\"token punctuation\">(</span>maxPoolSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        executor<span class=\"token punctuation\">.</span><span class=\"token function\">setQueueCapacity</span><span class=\"token punctuation\">(</span>queueCapacity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        executor<span class=\"token punctuation\">.</span><span class=\"token function\">setThreadNamePrefix</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"executor-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        executor<span class=\"token punctuation\">.</span><span class=\"token function\">setRejectedExecutionHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadPoolExecutor<span class=\"token punctuation\">.</span>CallerRunsPolicy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        executor<span class=\"token punctuation\">.</span><span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> executor<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h2 id=\"Async-ä½¿ç”¨æ³¨æ„\"><a href=\"#Async-ä½¿ç”¨æ³¨æ„\" class=\"headerlink\" title=\"@Async ä½¿ç”¨æ³¨æ„\"></a>@Async ä½¿ç”¨æ³¨æ„</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><code>@Async</code> æ ‡æ³¨çš„æ–¹æ³•ï¼Œç§°ä¹‹ä¸ºå¼‚æ­¥æ–¹æ³•ï¼›è¿™äº›æ–¹æ³•å°†åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œå°†ä¼šåœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸­è¢«æ‰§è¡Œï¼Œè°ƒç”¨è€…æ— éœ€ç­‰å¾…å®ƒçš„å®Œæˆï¼Œå³å¯ç»§ç»­å…¶ä»–çš„æ“ä½œ</p></blockquote>\n<ol>\n<li><code>@EnableAsync</code><br>  <code>@EnableAsync</code> ä¸èƒ½æ”¾åœ¨å¯åŠ¨ç±»ä¸Š</li>\n<li>è¢«æ³¨è§£çš„æ–¹æ³• éœ€è¦è¿”å›å€¼ ä¸º <code>void</code>, æˆ–è€…<code>Future</code>, å¦åˆ™ <code>@Async</code> æ— æ•ˆ</li>\n<li><code>@Async</code> æ³¨è§£çš„æ–¹æ³• å’Œ å…¶è°ƒç”¨æ–¹æ³• ä¸èƒ½æ”¾åœ¨åŒä¸€ä¸ªç±»é‡Œï¼Œ å¦åˆ™ <code>@Async</code> æ³¨è§£æ— æ•ˆ</li>\n</ol>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>ç”Ÿäº§ç¯å¢ƒä¸Š å‚æ•°å¯ä»¥å¾®è°ƒ</p>\n<ul>\n<li>æ¯æ¬¡æœ€å¤§æ‹‰å–çš„æ¡æ•°ï¼Œ</li>\n<li>çº¿ç¨‹æ± æ•°ï¼Œ ä»¥åŠé˜Ÿåˆ—æ•°ç›®</li>\n<li>JVM å †å¤§å°è°ƒæ•´</li>\n</ul>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>å…¶å® kafka çš„ æ¶ˆè´¹é€Ÿç‡å¾ˆå¿«ï¼Œä¸€èˆ¬å°±æ˜¯ ä¸€ä¸ª for å¾ªç¯ä¸åœåœ°æ‹‰å–æ¶ˆæ¯ï¼Œç„¶åäº¤ç»™çº¿ç¨‹æ± å¼‚æ­¥å¤„ç†ï¼Œä¸€èˆ¬ä¸ä¼šäº§ç”Ÿæ¶ˆæ¯å †ç§¯ã€‚<br>æ¶ˆæ¯æ¶ˆè´¹æƒ…å†µ å¯ å †ç§¯æƒ…å†µ ä¸€èˆ¬éƒ½å¯ä»¥çœ‹ä¸€ä¸‹ç›‘æ§ï¼Œ æˆ‘è¿™æ¬¡æœ€å¤šå †ç§¯äº† 10 äº¿æ¡ï¼Œ (åŸå› å°±æ˜¯å¯¹ @Async ä¸äº†è§£ï¼Œå°†@Async å’Œå…¶è°ƒåŠ¨æ–¹æ³•å¸è½½äº†åŒä¸€ä¸ªç±»é‡Œ  ğŸ˜¢ğŸ˜¢)</p>\n","text":" æœ€è¿‘ä½¿ç”¨kafka, æ¶ˆè´¹è€…é€Ÿåº¦ä¸€ç›´è·Ÿä¸ä¸Šï¼Œé€ æˆçº¿ä¸Šæ¶ˆæ¯å †ç§¯åˆ°äº† 101äº¿ï¼Œå›°æ‰°äº†å¥½å‡ å¤©ï¼Œç»ˆäºè§£å†³äº†ã€‚ï¼ˆå…¶å®å¾ˆç®€å•ï¼Œå› ä¸º kafkaæ¶ˆè´¹é€Ÿåº¦æœ¬æ¥ä¹Ÿä¸æ…¢ ğŸ˜‚ğŸ˜‚ğŸ˜‚ğŸ˜‚,å…¶å®å¼‚æ­¥+ æ‰¹é‡æ¶ˆè´¹å°±æ»¡å¯ä»¥è¾¾åˆ°è¦æ±‚äº†ï¼‰ ä¸»è¦åŸå› æœ‰ä¸¤ä¸ªï¼Œ å¯¹ @Async æ³¨è§£çš„ä¸ç†è§£ æ‰¹é‡æ¶ˆè´¹ â€“ è¿˜æœ‰å°±æ˜¯é€š...","link":"","photos":[],"count_time":{"symbolsCount":"4.6k","symbolsTime":"4 mins."},"categories":[{"name":"kafka","slug":"kafka","count":4,"path":"api/categories/kafka.json"},{"name":"consumer","slug":"kafka/consumer","count":1,"path":"api/categories/kafka/consumer.json"}],"tags":[{"name":"kafka","slug":"kafka","count":3,"path":"api/tags/kafka.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Async-%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F\"><span class=\"toc-text\">@Async ä½¿ç”¨æ³¨æ„</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\"><span class=\"toc-text\"></span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">æ€»ç»“</span></a></li></ol>","author":{"name":"majm","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"æŠ€æœ¯åˆ†äº«","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"linuxä¸‹ç›‘æ§å®æ—¶ç½‘é€Ÿ","uid":"3191f51398b532ce218b33ad1c80d29d","slug":"linuxä¸‹ç›‘æ§å®æ—¶ç½‘é€Ÿ","date":"2019-08-13T09:48:52.000Z","updated":"2020-09-14T07:22:38.000Z","comments":true,"path":"api/articles/linuxä¸‹ç›‘æ§å®æ—¶ç½‘é€Ÿ.json","keywords":null,"cover":[],"text":" NetHogsæ˜¯ä¸€ä¸ªå°å‹çš„â€™net topâ€™å·¥å…·,ä¸åƒå¤§å¤šæ•°å·¥å…·é‚£æ ·æ‹–æ…¢æ¯ä¸ªåè®®æˆ–è€…æ˜¯æ¯ä¸ªå­ç½‘çš„é€Ÿåº¦è€Œæ˜¯æŒ‰ç…§è¿›ç¨‹è¿›è¡Œå¸¦å®½åˆ†ç»„.NetHogs NetHogsä¸éœ€è¦ä¾èµ–è½½å…¥æŸä¸ªç‰¹æ®Šçš„å†…æ ¸æ¨¡å—. å¦‚æœå‘ç”Ÿäº†ç½‘ç»œé˜»å¡ä½ å¯ä»¥å¯åŠ¨NetHogsç«‹å³çœ‹åˆ°å“ªä¸ªPIDé€ æˆçš„è¿™ç§çŠ¶å†µ.è¿™æ ·å°±å¾ˆå®¹...","link":"","photos":[],"count_time":{"symbolsCount":472,"symbolsTime":"1 mins."},"categories":[{"name":"linux","slug":"linux","count":2,"path":"api/categories/linux.json"}],"tags":[{"name":"linux","slug":"linux","count":2,"path":"api/tags/linux.json"}],"author":{"name":"majm","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"æŠ€æœ¯åˆ†äº«","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"redis-infoå‘½ä»¤è¯¦è§£","uid":"37aab8e3df469d14892fd29b0404f0e2","slug":"redis-infoå‘½ä»¤è¯¦è§£","date":"2019-07-22T09:44:36.000Z","updated":"2019-07-22T09:46:17.000Z","comments":true,"path":"api/articles/redis-infoå‘½ä»¤è¯¦è§£.json","keywords":null,"cover":null,"text":" redis info å‘½ä»¤è¯¦è§£ 192.168.5.244(192.168.5.244:7001)&gt;info all &quot;# Server redis_version:3.0.6 redis_git_sha1:00000000 redis_git_dirty:0 ...","link":"","photos":[],"count_time":{"symbolsCount":"8k","symbolsTime":"7 mins."},"categories":[{"name":"redis","slug":"redis","count":1,"path":"api/categories/redis.json"}],"tags":[{"name":"redis","slug":"redis","count":1,"path":"api/tags/redis.json"}],"author":{"name":"majm","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"æŠ€æœ¯åˆ†äº«","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}